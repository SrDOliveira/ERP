{% extends 'core/base.html' %}

{% block title %}Ajuste de Estoque{% endblock %}
{% block breadcrumb %}Estoque / Ajustes e Perdas{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row">
        
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header bg-white fw-bold">
                    <i class="bi bi-pencil-square me-2"></i> Registrar Movimentação
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-4">
                        Use esta tela para corrigir o estoque (perdas, roubos, consumo interno ou entrada sem nota).
                    </p>
                    
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label class="form-label small fw-bold text-uppercase">Produto</label>
                            {{ form.produto }}
                        </div>

                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label small fw-bold text-uppercase">Quantidade</label>
                                {{ form.quantidade }}
                                <div class="form-text small">Apenas números (Ex: 5)</div>
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label small fw-bold text-uppercase">Motivo</label>
                                {{ form.motivo }}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label small fw-bold text-uppercase">Observação</label>
                            {{ form.observacao }}
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-dark">
                                Confirmar Ajuste
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card h-100">
                <div class="card-header bg-white fw-bold d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-clock-history me-2"></i> Últimos Ajustes</span>
                    <span class="badge bg-light text-dark border">Histórico Recente</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Data</th>
                                <th>Produto</th>
                                <th>Motivo</th>
                                <th class="text-end">Qtd</th>
                                <th>Resp.</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ajuste in ajustes %}
                            <tr>
                                <td style="white-space: nowrap;">
                                    <span class="fw-bold">{{ ajuste.data_ajuste|date:"d/m" }}</span>
                                    <small class="text-muted">{{ ajuste.data_ajuste|date:"H:i" }}</small>
                                </td>
                                <td>
                                    <span class="fw-bold text-dark">{{ ajuste.produto.nome }}</span>
                                    {% if ajuste.observacao %}
                                        <br><small class="text-muted fst-italic">{{ ajuste.observacao }}</small>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if ajuste.motivo == 'ENTRADA' %}
                                        <span class="badge bg-success bg-opacity-10 text-success border border-success">Entrada</span>
                                    {% elif ajuste.motivo == 'DEFEITO' %}
                                        <span class="badge bg-danger bg-opacity-10 text-danger border border-danger">Defeito</span>
                                    {% elif ajuste.motivo == 'PERDA' %}
                                        <span class="badge bg-dark text-white">Perda/Roubo</span>
                                    {% else %}
                                        <span class="badge bg-secondary bg-opacity-10 text-secondary border">{{ ajuste.get_motivo_display }}</span>
                                    {% endif %}
                                </td>
                                <td class="text-end fw-bold">
                                    {% if ajuste.motivo == 'ENTRADA' %}
                                        <span class="text-success">+{{ ajuste.quantidade }}</span>
                                    {% else %}
                                        <span class="text-danger">-{{ ajuste.quantidade }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small class="text-muted text-uppercase">{{ ajuste.responsavel.username }}</small>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center p-5 text-muted">
                                    <i class="bi bi-box-seam display-4 opacity-25"></i>
                                    <p class="mt-3">Nenhum ajuste registrado ainda.</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}